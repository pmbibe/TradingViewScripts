// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Volume Structure Analyzer v2.0 - MAJOR BUG FIXES

//@version=5
indicator("Volume Structure Analyzer", shorttitle="VSA", overlay=true, max_boxes_count=50, max_lines_count=50, max_labels_count=100)

// ═══════════════════════════════════════════════════════════════════════════════
// DESCRIPTION & USAGE
// ═══════════════════════════════════════════════════════════════════════════════
// This indicator analyzes volume patterns and price structure to identify
// accumulation/distribution zones and generate trading signals based on
// Wyckoff methodology and Volume Price Analysis (VPA).
//
// VERSION 2.0 FIXES:
// - Fixed accumulation zone detection (was too strict, now properly tracks consolidation)
// - Simplified distribution zone detection (was overly complex)
// - Fixed breakout confirmation logic (removed future bar dependency)
// - Improved box visualization (no more repainting)
// - Better signal generation (lower thresholds, more realistic scoring)
// - Added debugging features for troubleshooting
//
// Author: Pine Script Expert
// Version: 2.0
// Date: 2025-12-15
// ═══════════════════════════════════════════════════════════════════════════════

// ═══════════════════════════════════════════════════════════════════════════════
// USER INPUT PARAMETERS
// ═══════════════════════════════════════════════════════════════════════════════

// Volume Settings
volume_period = input.int(20, "Volume Period", minval=10, maxval=50, group="Volume Settings")
volume_climax_threshold = input.float(2.0, "Volume Climax Threshold", minval=1.5, maxval=3.0, step=0.1, group="Volume Settings")
breakout_volume_mult = input.float(1.5, "Breakout Volume Multiplier", minval=1.2, maxval=2.0, step=0.1, group="Volume Settings")

// Structure Settings - ADJUSTED FOR BETTER DETECTION
accum_bars_required = input.int(8, "Accumulation Bars Required", minval=5, maxval=15, group="Structure Settings")
dist_bars_required = input.int(5, "Distribution Bars Required", minval=3, maxval=10, group="Structure Settings")
atr_period = input.int(14, "ATR Period", minval=5, maxval=50, group="Structure Settings")
lookback_period = input.int(10, "Pivot Lookback Period", minval=5, maxval=20, group="Structure Settings")

// Display Options
show_accumulation = input.bool(true, "Show Accumulation Zones", group="Display Options")
show_distribution = input.bool(true, "Show Distribution Zones", group="Display Options")
show_volume_hist = input.bool(true, "Show Volume Histogram", group="Display Options")
show_signals = input.bool(true, "Show Buy/Sell Signals", group="Display Options")
show_divergence = input.bool(true, "Show Divergence Lines", group="Display Options")
show_warnings = input.bool(true, "Show Warning Labels", group="Display Options")
show_debug = input.bool(false, "Show Debug Markers", group="Display Options")

// Alert Settings
alert_on_strong_signals = input.bool(false, "Alert on Strong Signals", group="Alert Settings")

// ═══════════════════════════════════════════════════════════════════════════════
// HELPER FUNCTIONS
// ═══════════════════════════════════════════════════════════════════════════════

// Calculate price change percentage
getPriceChange() =>
    ((close - close[1]) / close[1]) * 100

// Check if candle body is strong
isStrongBody(threshold) =>
    candle_range = high - low
    candle_body = math.abs(close - open)
    candle_range > 0 ? (candle_body / candle_range) >= threshold : false

// Get upper wick percentage
getUpperWickPct() =>
    candle_range = high - low
    upper_wick = high - math.max(open, close)
    candle_range > 0 ? (upper_wick / candle_range) : 0

// Check if closed in upper half
closedInUpperHalf() =>
    candle_range = high - low
    close_position = close - low
    candle_range > 0 ? (close_position / candle_range) >= 0.5 : false

// Volume slope calculation
getVolumeSlope(lookback) =>
    sum_x = 0.0
    sum_y = 0.0
    sum_xy = 0.0
    sum_xx = 0.0
    for i = 0 to lookback - 1
        x = i
        y = volume[i]
        sum_x += x
        sum_y += y
        sum_xy += x * y
        sum_xx += x * x
    n = lookback
    slope = (n * sum_xy - sum_x * sum_y) / (n * sum_xx - sum_x * sum_x)
    slope

// ═══════════════════════════════════════════════════════════════════════════════
// VOLUME ANALYSIS MODULE
// ═══════════════════════════════════════════════════════════════════════════════

// Basic Volume Calculations
vol_sma = ta.sma(volume, volume_period)
vol_fast_ma = ta.sma(volume, 10)
vol_slow_ma = ta.sma(volume, 20)

// Volume Ratio
volume_ratio = vol_sma > 0 ? volume / vol_sma : 0

// Volume Strength Index (VSI)
vsi = (volume / vol_sma) * 100

// Price Change
price_change = getPriceChange()

// Volume Climax Detection
bullish_climax = volume_ratio > volume_climax_threshold and price_change > 3.0
bearish_climax = volume_ratio > volume_climax_threshold and price_change < -3.0

// Volume Trend
volume_trend_bullish = vol_fast_ma > vol_slow_ma
volume_trend_bearish = vol_fast_ma < vol_slow_ma

// Volume declining check
volume_declining = getVolumeSlope(10) < 0

// ═══════════════════════════════════════════════════════════════════════════════
// DIVERGENCE DETECTION MODULE
// ═══════════════════════════════════════════════════════════════════════════════

// Find pivot highs and lows
pivot_high = ta.pivothigh(high, lookback_period, lookback_period)
pivot_low = ta.pivotlow(low, lookback_period, lookback_period)

// Store pivot values
var float last_pivot_high_price = na
var int last_pivot_high_bar = na
var float last_pivot_high_volume = na

var float last_pivot_low_price = na
var int last_pivot_low_bar = na
var float last_pivot_low_volume = na

// Update pivot highs
if not na(pivot_high)
    last_pivot_high_price := high[lookback_period]
    last_pivot_high_bar := bar_index - lookback_period
    last_pivot_high_volume := volume[lookback_period]

// Update pivot lows
if not na(pivot_low)
    last_pivot_low_price := low[lookback_period]
    last_pivot_low_bar := bar_index - lookback_period
    last_pivot_low_volume := volume[lookback_period]

// Detect divergences
var bool bearish_divergence = false
var bool bullish_divergence = false

// Bearish Divergence: Price Higher High but Volume Lower High
if not na(pivot_high) and not na(last_pivot_high_price)
    current_price_hh = high[lookback_period] > last_pivot_high_price
    current_volume_lh = volume[lookback_period] < last_pivot_high_volume
    bearish_divergence := current_price_hh and current_volume_lh
else
    bearish_divergence := false

// Bullish Divergence: Price Lower Low but Volume Lower Low
if not na(pivot_low) and not na(last_pivot_low_price)
    current_price_ll = low[lookback_period] < last_pivot_low_price
    current_volume_ll = volume[lookback_period] < last_pivot_low_volume
    bullish_divergence := current_price_ll and current_volume_ll
else
    bullish_divergence := false

// ═══════════════════════════════════════════════════════════════════════════════
// FIX #1: CORRECTED ACCUMULATION ZONE DETECTION
// ═══════════════════════════════════════════════════════════════════════════════

// ATR for range calculations
atr = ta.atr(atr_period)

// Accumulation state variables
var int accum_start_bar = na
var float accum_high = na
var float accum_low = na
var bool in_accumulation = false
var int consolidation_count = 0

// Calculate price range percentage (more reliable than absolute ATR)
range_pct = (high - low) / close * 100

// FIXED: Relaxed consolidation detection - allow some movement
is_consolidating = range_pct < 2.0 or (high - low) < (atr * 0.6)

// FIXED: Count consecutive consolidation bars WITHOUT immediate reset
if is_consolidating
    consolidation_count += 1
    if consolidation_count == 1
        accum_start_bar := bar_index
        accum_high := high
        accum_low := low
    else
        accum_high := math.max(accum_high, high)
        accum_low := math.min(accum_low, low)
else
    // FIXED: Don't immediately reset - allow 2-3 wider bars in consolidation
    if consolidation_count > 0 and range_pct > 4.0
        consolidation_count := math.max(0, consolidation_count - 2)

// FIXED: Enter accumulation after required bars (default 8, was 10)
if consolidation_count >= accum_bars_required and not in_accumulation
    in_accumulation := true

// IMPROVED: Simplified Spring Detection
spring_test = volume_ratio > 1.8 and low <= ta.lowest(low, 15) and close > (high + low) / 2

// FIXED: Better Accumulation Score calculation
accum_score = 0
if in_accumulation
    if consolidation_count >= accum_bars_required
        accum_score += 30
    if volume_declining
        accum_score += 25
    if spring_test
        accum_score += 30
    if volume < vol_sma * 0.8  // Low volume in range
        accum_score += 15

// ═══════════════════════════════════════════════════════════════════════════════
// FIX #2: SIMPLIFIED DISTRIBUTION ZONE DETECTION
// ═══════════════════════════════════════════════════════════════════════════════

// Distribution state variables
var int dist_start_bar = na
var float dist_high = na
var float dist_low = na
var bool in_distribution = false
var int topping_count = 0

// FIXED: Simplified trend detection
ema50 = ta.ema(close, 50)
in_uptrend = close > ema50 and ema50 > ema50[5]

// FIXED: Topping pattern - price near recent highs but struggling
recent_high = ta.highest(high, 30)
near_high = high >= recent_high * 0.95
price_stalling = math.abs(close - open) < (high - low) * 0.4

// FIXED: Volume decreasing at highs (simplified)
vol_decreasing_at_top = volume < ta.sma(volume, 5) and near_high

// FIXED: Large upper wicks appearing (rejection)
upper_wick_pct = (high - math.max(open, close)) / (high - low + 0.0001)  // Avoid division by zero
rejection_wicks = upper_wick_pct > 0.35

// FIXED: Count topping bars (more lenient)
if in_uptrend and (near_high or high == recent_high)
    if vol_decreasing_at_top or rejection_wicks or price_stalling
        topping_count += 1
        if topping_count == 1
            dist_start_bar := bar_index
            dist_high := high
            dist_low := low
        else
            dist_high := math.max(dist_high, high)
            dist_low := math.min(dist_low, low)
else
    if not in_distribution
        topping_count := math.max(0, topping_count - 1)

// FIXED: Enter distribution after required bars (default 5)
if topping_count >= dist_bars_required and not in_distribution
    in_distribution := true

// FIXED: Simplified Distribution Score
dist_score = 0
if in_distribution
    if topping_count >= dist_bars_required
        dist_score += 30
    if vol_decreasing_at_top
        dist_score += 25
    if rejection_wicks
        dist_score += 25
    if ta.rsi(close, 14) > 65  // Overbought condition
        dist_score += 20

// ═══════════════════════════════════════════════════════════════════════════════
// FIX #3: IMPROVED BREAKOUT CONFIRMATION (NO FUTURE BAR DEPENDENCY)
// ═══════════════════════════════════════════════════════════════════════════════

// FIXED: Bullish Breakout - Immediate confirmation on current bar
bullish_breakout_signal = false
if in_accumulation and not na(accum_high)
    breakout_price = close > accum_high * 1.005  // 0.5% above zone
    breakout_volume = volume > vol_sma * breakout_volume_mult
    strong_candle = close > open and (close - open) > (high - low) * 0.5

    if breakout_price and breakout_volume and strong_candle
        bullish_breakout_signal := true
        in_accumulation := false
        consolidation_count := 0

// FIXED: Bearish Breakdown - Immediate confirmation on current bar
bearish_breakdown_signal = false
if in_distribution and not na(dist_low)
    breakdown_price = close < dist_low * 0.995  // 0.5% below zone
    breakdown_volume = volume > vol_sma * breakout_volume_mult
    strong_candle = close < open and (open - close) > (high - low) * 0.5

    if breakdown_price and breakdown_volume and strong_candle
        bearish_breakdown_signal := true
        in_distribution := false
        topping_count := 0

// Store confirmed breakout signals
var bool confirmed_bull_breakout = false
var bool confirmed_bear_breakdown = false
confirmed_bull_breakout := bullish_breakout_signal
confirmed_bear_breakdown := bearish_breakdown_signal

// ═══════════════════════════════════════════════════════════════════════════════
// FIX #5: IMPROVED SIGNAL GENERATION
// ═══════════════════════════════════════════════════════════════════════════════

// FIXED: Better BUY Signal Scoring
buy_score = 0

// Check if we had recent accumulation (last 20 bars)
recent_accumulation = ta.barssince(in_accumulation) < 20 or in_accumulation
if recent_accumulation
    buy_score += 30

if spring_test
    buy_score += 25

if confirmed_bull_breakout
    buy_score += 30

if bullish_divergence
    buy_score += 15

// Reduce score if bearish conditions
if bearish_divergence
    buy_score -= 25

if ta.rsi(close, 14) > 75
    buy_score -= 15

// Ensure score is 0-100
buy_score := math.max(0, math.min(100, buy_score))

// FIXED: Better SELL Signal Scoring
sell_score = 0

// Check if we had recent distribution
recent_distribution = ta.barssince(in_distribution) < 20 or in_distribution
if recent_distribution
    sell_score += 30

if bearish_climax and rejection_wicks
    sell_score += 25

if confirmed_bear_breakdown
    sell_score += 30

if bearish_divergence
    sell_score += 15

// Reduce score if bullish conditions
if bullish_divergence
    sell_score -= 25

if ta.rsi(close, 14) < 25
    sell_score -= 15

sell_score := math.max(0, math.min(100, sell_score))

// FIXED: Lower thresholds for signal triggers (70 instead of 75)
strong_buy = show_signals and buy_score >= 70
buy_signal = show_signals and buy_score >= 50 and buy_score < 70

strong_sell = show_signals and sell_score >= 70
sell_signal = show_signals and sell_score >= 50 and sell_score < 70

// ═══════════════════════════════════════════════════════════════════════════════
// WARNING SIGNALS (FIXED TO TRIGGER ONCE)
// ═══════════════════════════════════════════════════════════════════════════════

// Weak breakout warning
weak_breakout = (confirmed_bull_breakout or confirmed_bear_breakdown) and volume < vol_sma * 1.2 and volume > 0

// Exhaustion detection - only trigger once
var bool was_exhausted = false
trend_length = 0
if close > close[1]
    trend_length := ta.barssince(close < close[1])
else if close < close[1]
    trend_length := ta.barssince(close > close[1])

is_exhausted = (bullish_climax or bearish_climax) and trend_length > 20
exhaustion = is_exhausted and not was_exhausted
was_exhausted := is_exhausted

// Consolidation detection - only trigger once
var bool was_consolidating = false
atr_declining = atr < ta.sma(atr, 5)
is_consolidating_warning = atr_declining and ta.barssince(not atr_declining) >= 5
consolidation = is_consolidating_warning and not was_consolidating
was_consolidating := is_consolidating_warning

// ═══════════════════════════════════════════════════════════════════════════════
// FIX #4: IMPROVED BOX VISUALIZATION (NO REPAINTING)
// ═══════════════════════════════════════════════════════════════════════════════

// FIXED: Better box management - delete and recreate for updates
var box accum_box = na

if show_accumulation
    if in_accumulation and not na(accum_start_bar)
        // Delete old box if exists
        if not na(accum_box)
            box.delete(accum_box)

        // Create new box with current data
        accum_box := box.new(
            left=accum_start_bar,
            top=accum_high,
            right=bar_index + 1,  // Extend to next bar
            bottom=accum_low,
            border_color=color.new(color.green, 0),
            bgcolor=color.new(color.green, 90),
            border_width=2,
            text="ACCUMULATION\nScore: " + str.tostring(accum_score) + "\nBars: " + str.tostring(consolidation_count),
            text_color=color.green,
            text_size=size.small,
            text_halign=text.align_left,
            text_valign=text.align_top
        )
    else if not in_accumulation
        accum_box := na

// FIXED: Distribution box with better management
var box dist_box = na

if show_distribution
    if in_distribution and not na(dist_start_bar)
        // Delete old box if exists
        if not na(dist_box)
            box.delete(dist_box)

        // Create new box with current data
        dist_box := box.new(
            left=dist_start_bar,
            top=dist_high,
            right=bar_index + 1,
            bottom=dist_low,
            border_color=color.new(color.red, 0),
            bgcolor=color.new(color.red, 90),
            border_width=2,
            text="DISTRIBUTION\nScore: " + str.tostring(dist_score) + "\nBars: " + str.tostring(topping_count),
            text_color=color.red,
            text_size=size.small,
            text_halign=text.align_left,
            text_valign=text.align_top
        )
    else if not in_distribution
        dist_box := na

// ═══════════════════════════════════════════════════════════════════════════════
// VISUAL PLOTTING - MAIN CHART
// ═══════════════════════════════════════════════════════════════════════════════

// Background Colors for Signals
bg_color = color.new(color.white, 100)
if strong_buy
    bg_color := color.new(color.green, 85)
else if buy_signal
    bg_color := color.new(color.green, 92)
else if strong_sell
    bg_color := color.new(color.red, 85)
else if sell_signal
    bg_color := color.new(color.red, 92)

bgcolor(bg_color, title="Signal Background")

// FIX #7: Larger, more visible climax markers
plotshape(bullish_climax, "Bull Climax", shape.circle, location.belowbar,
          color.new(color.lime, 0), size=size.small, text="VC")
plotshape(bearish_climax, "Bear Climax", shape.circle, location.abovebar,
          color.new(color.red, 0), size=size.small, text="VC")

// Breakout Triangles
plotshape(confirmed_bull_breakout, title="Bullish Breakout", location=location.belowbar,
          color=color.green, style=shape.triangleup, size=size.normal)

plotshape(confirmed_bear_breakdown, title="Bearish Breakdown", location=location.abovebar,
          color=color.red, style=shape.triangledown, size=size.normal)

// FIX #8: Add zone exit lines
var line breakout_line = na
var line breakdown_line = na

if confirmed_bull_breakout and not na(accum_high)
    breakout_line := line.new(bar_index, accum_high, bar_index + 10, accum_high,
                              color=color.green, width=2, style=line.style_dashed)

if confirmed_bear_breakdown and not na(dist_low)
    breakdown_line := line.new(bar_index, dist_low, bar_index + 10, dist_low,
                               color=color.red, width=2, style=line.style_dashed)

// Signal Labels
if strong_buy
    label.new(bar_index, low, "STRONG BUY\n" + str.tostring(buy_score),
              style=label.style_label_up, color=color.new(color.green, 20),
              textcolor=color.white, size=size.normal)

if buy_signal
    label.new(bar_index, low, "BUY\n" + str.tostring(buy_score),
              style=label.style_label_up, color=color.new(color.green, 40),
              textcolor=color.white, size=size.small)

if strong_sell
    label.new(bar_index, high, "STRONG SELL\n" + str.tostring(sell_score),
              style=label.style_label_down, color=color.new(color.red, 20),
              textcolor=color.white, size=size.normal)

if sell_signal
    label.new(bar_index, high, "SELL\n" + str.tostring(sell_score),
              style=label.style_label_down, color=color.new(color.red, 40),
              textcolor=color.white, size=size.small)

// Divergence Labels
if show_divergence and bearish_divergence
    label.new(bar_index - lookback_period, high[lookback_period], "BEAR DIV",
              style=label.style_label_down, color=color.orange,
              textcolor=color.white, size=size.small)

if show_divergence and bullish_divergence
    label.new(bar_index - lookback_period, low[lookback_period], "BULL DIV",
              style=label.style_label_up, color=color.blue,
              textcolor=color.white, size=size.small)

// Warning Labels
if show_warnings and weak_breakout
    label.new(bar_index, high * 1.002, "⚠ WEAK",
              style=label.style_label_down, color=color.new(color.yellow, 20),
              textcolor=color.black, size=size.tiny)

if show_warnings and exhaustion
    label.new(bar_index, high * 1.004, "⚠ EXHAUSTION",
              style=label.style_label_down, color=color.new(color.orange, 20),
              textcolor=color.white, size=size.tiny)

if show_warnings and consolidation
    label.new(bar_index, high * 1.001, "⚠ CONSOLIDATION",
              style=label.style_label_down, color=color.new(color.gray, 40),
              textcolor=color.white, size=size.tiny)

// Signal tracking dots
plot(strong_buy or buy_signal ? low * 0.999 : na, title="Buy Dots",
     color=color.green, style=plot.style_circles, linewidth=2)
plot(strong_sell or sell_signal ? high * 1.001 : na, title="Sell Dots",
     color=color.red, style=plot.style_circles, linewidth=2)

// ═══════════════════════════════════════════════════════════════════════════════
// VISUAL PLOTTING - VOLUME PANEL
// ═══════════════════════════════════════════════════════════════════════════════

// Volume Histogram Color Logic
vol_color = color.gray
if show_volume_hist
    if volume > vol_sma
        if close > open
            vol_color := color.green  // Vol up + Price up
        else
            vol_color := bullish_climax ? color.new(color.lime, 30) : color.new(color.green, 60)
    else
        if close < open
            vol_color := color.red  // Vol down + Price down
        else
            vol_color := bearish_climax ? color.new(color.red, 30) : color.new(color.red, 60)

    // Climax highlights
    if bullish_climax
        vol_color := color.new(color.lime, 0)
    if bearish_climax
        vol_color := color.new(color.red, 0)

// Plot volume histogram
plot(show_volume_hist ? volume : na, title="Volume", color=vol_color,
     style=plot.style_histogram, linewidth=1)

// Volume MA lines
plot(show_volume_hist ? vol_fast_ma : na, title="Fast Vol MA",
     color=color.blue, linewidth=1)
plot(show_volume_hist ? vol_slow_ma : na, title="Slow Vol MA",
     color=color.orange, linewidth=1)

// Threshold line
plot(show_volume_hist ? vol_sma * volume_climax_threshold : na,
     title="Climax Threshold", color=color.gray, linewidth=1, style=plot.style_linebr)

// Volume trend background
vol_bg_color = volume_trend_bullish ? color.new(color.green, 95) : color.new(color.red, 95)
bgcolor(show_volume_hist ? vol_bg_color : na, title="Volume Trend BG")

// ═══════════════════════════════════════════════════════════════════════════════
// FIX #6: DEBUGGING FEATURES
// ═══════════════════════════════════════════════════════════════════════════════

// Debug plots (visible in data window)
plot(consolidation_count, "Consol Count", color=color.blue, display=display.data_window)
plot(topping_count, "Topping Count", color=color.orange, display=display.data_window)
plot(in_accumulation ? 1 : 0, "In Accum", color=color.green, display=display.data_window)
plot(in_distribution ? 1 : 0, "In Dist", color=color.red, display=display.data_window)
plot(accum_score, "Accum Score", color=color.green, display=display.data_window)
plot(dist_score, "Dist Score", color=color.red, display=display.data_window)
plot(range_pct, "Range %", color=color.yellow, display=display.data_window)

// Visual debug markers (optional)
plotchar(show_debug and is_consolidating, "Consolidating", "●", location.top, color.blue, size=size.tiny)
plotchar(show_debug and near_high and in_uptrend, "Near High", "●", location.top, color.orange, size=size.tiny)

// ═══════════════════════════════════════════════════════════════════════════════
// INDICATOR PANEL - ADDITIONAL METRICS
// ═══════════════════════════════════════════════════════════════════════════════

// Volume Strength Index (0-300 scale)
plot(vsi, title="VSI", color=color.purple, linewidth=2, display=display.none)

// Accumulation Score (0-100)
plot(accum_score, title="Accumulation Score", color=color.green, linewidth=2, display=display.none)

// Distribution Score (0-100)
plot(dist_score, title="Distribution Score", color=color.red, linewidth=2, display=display.none)

// Overall Signal Strength (-100 to +100)
overall_signal = buy_score - sell_score
plot(overall_signal, title="Overall Signal Strength", color=color.blue, linewidth=2, display=display.none)

// ═══════════════════════════════════════════════════════════════════════════════
// ALERT CONDITIONS
// ═══════════════════════════════════════════════════════════════════════════════

// Strong Buy Signal
alertcondition(strong_buy and alert_on_strong_signals,
               title="Strong Buy Signal",
               message="VSA: Strong Buy Signal Detected (Score: " + str.tostring(buy_score) + ")")

// Strong Sell Signal
alertcondition(strong_sell and alert_on_strong_signals,
               title="Strong Sell Signal",
               message="VSA: Strong Sell Signal Detected (Score: " + str.tostring(sell_score) + ")")

// Volume Climax
alertcondition(bullish_climax or bearish_climax,
               title="Volume Climax Detected",
               message="VSA: Volume Climax Detected")

// Accumulation Zone
alertcondition(in_accumulation and consolidation_count == accum_bars_required,
               title="Accumulation Zone Formed",
               message="VSA: Accumulation Zone Formed")

// Distribution Zone
alertcondition(in_distribution and topping_count == dist_bars_required,
               title="Distribution Zone Formed",
               message="VSA: Distribution Zone Formed")

// Bullish Breakout
alertcondition(confirmed_bull_breakout,
               title="Bullish Breakout Confirmed",
               message="VSA: Bullish Breakout Confirmed")

// Bearish Breakdown
alertcondition(confirmed_bear_breakdown,
               title="Bearish Breakdown Confirmed",
               message="VSA: Bearish Breakdown Confirmed")

// ═══════════════════════════════════════════════════════════════════════════════
// END OF INDICATOR - VERSION 2.0
// ═══════════════════════════════════════════════════════════════════════════════
